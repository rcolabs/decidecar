<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DecideCar ‚Äî RCO Labs</title>
  <style>
    :root{
      --bg:#F6F7F9;
      --card:#FFFFFF;
      --text:#1F2937;
      --muted:#6B7280;
      --border:rgba(17,24,39,.10);
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --primary:#111827;
      --primary2:#0B1220;
      --good:#0E9F6E;
      --bad:#DC2626;
      --chip:#F3F4F6;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Inter',sans-serif;
      background:var(--bg); color:var(--text); line-height:1.55;
      -webkit-font-smoothing:antialiased;
    }
    .container{max-width:560px;margin:0 auto;min-height:100vh;padding:16px 16px 92px;}
    .screen{display:none}
    .screen.active{display:block}

    .topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(246,247,249,.92);
      backdrop-filter:saturate(180%) blur(10px);
      border-bottom:1px solid rgba(17,24,39,.08);
      margin:0 -16px 14px;
    }
    .topbar-inner{
      max-width:560px; margin:0 auto; padding:10px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{display:flex;flex-direction:column;line-height:1.08}
    .brand .name{font-weight:900;letter-spacing:.2px}
    .brand .sub{font-size:12px;color:var(--muted);font-weight:700}
    .iconbtn{
      border:1px solid var(--border);
      background:var(--card);
      padding:10px 12px;border-radius:14px;
      font-weight:800;color:var(--primary);
      cursor:pointer;
      box-shadow: 0 1px 0 rgba(17,24,39,.04);
    }
    .iconbtn:active{transform:translateY(1px)}

    .hero{padding:12px 0 18px;text-align:left}
    .hero h1{font-size:30px;line-height:1.12;margin-top:6px;letter-spacing:-.4px}
    .hero p{margin-top:10px;color:var(--muted);font-size:16px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .chip{
      font-size:12px;font-weight:800;
      color:rgba(17,24,39,.72);
      background:var(--chip);
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(17,24,39,.06);
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      margin-bottom:12px;
      box-shadow: var(--shadow);
    }
    .card-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .card-header h3{font-size:16px;font-weight:900}
    .card-sub{margin-top:6px;color:var(--muted);font-size:13px;font-weight:650}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:420px){.grid2{grid-template-columns:1fr}}
    label{display:block;font-size:13px;color:var(--muted);font-weight:900;margin-bottom:6px}
    input,select{
      width:100%;
      padding:12px 12px;
      border:1px solid rgba(17,24,39,.16);
      border-radius:14px;
      font-size:16px;color:var(--text);
      background:#fff;
    }
    input:focus,select:focus{outline:none;border-color:rgba(17,24,39,.45)}
    .help{margin-top:6px;font-size:12px;color:rgba(107,114,128,.95);font-weight:650}

    .btn{
      width:100%;
      padding:14px 16px;
      border:none;border-radius:16px;
      background:var(--primary);color:#fff;
      font-size:16px;font-weight:950;cursor:pointer;
      letter-spacing:-.1px;
    }
    .btn:hover{background:var(--primary2)}
    .btn.secondary{
      background:#fff;color:var(--primary);
      border:2px solid rgba(17,24,39,.28);
    }
    .btn.small{padding:10px 12px;border-radius:14px;font-size:14px}
    .rowbtns{display:flex;gap:10px}
    .rowbtns .btn{flex:1}

    .cta-fixed{
      position:fixed; left:0; right:0; bottom:0; z-index:60;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(180%) blur(10px);
      border-top:1px solid rgba(17,24,39,.10);
      padding:12px 16px;
    }
    .cta-fixed-inner{max-width:560px;margin:0 auto}

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(17,24,39,.06); color:var(--primary);
      padding:8px 12px;border-radius:999px;
      font-weight:950;font-size:13px;margin-top:6px;
      border:1px solid rgba(17,24,39,.08);
    }
    .big{font-size:40px;font-weight:1000;color:var(--primary);margin:10px 0 6px;letter-spacing:-.7px}
    .muted{color:var(--muted)}
    .diff{font-weight:950;margin-top:8px}
    .insight{
      background:#F8FAFC;
      border:1px solid rgba(17,24,39,.10);
      padding:14px;border-radius:14px;
      color:rgba(31,41,55,.90);
      font-weight:750;font-size:14px;
    }
    .trust{
      margin-top:10px;
      background:rgba(14,159,110,.08);
      border:1px solid rgba(14,159,110,.18);
      padding:12px;border-radius:14px;
      color:rgba(17,24,39,.88);
      font-weight:750;font-size:13px;
    }
    .trust ul{margin:8px 0 0 16px}
    .trust li{margin:4px 0}
    .kpi3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    @media (max-width:520px){.kpi3{grid-template-columns:1fr}}
    .kpi{border:1px solid rgba(17,24,39,.10);border-radius:16px;padding:14px;background:#fff}
    .kpi .t{font-size:12px;color:var(--muted);font-weight:950}
    .kpi .v{margin-top:6px;font-size:18px;font-weight:1000}

    .section-title{font-size:14px;font-weight:1000;margin-bottom:10px;color:rgba(17,24,39,.92)}
    .divider{height:1px;background:rgba(17,24,39,.08);margin:12px 0}

    .chart-wrap{
      padding:12px;
      border:1px solid rgba(17,24,39,.10);
      border-radius:16px;
      background:#fff;
    }
    canvas{width:100%;height:220px}
    .chart-note{font-size:12px;color:var(--muted);margin-top:8px;font-weight:650}

    .advanced-toggle{
      display:flex;justify-content:space-between;align-items:center;gap:10px;
      width:100%;
      background:rgba(17,24,39,.04);
      border:1px solid rgba(17,24,39,.10);
      padding:12px 14px;border-radius:16px;
      cursor:pointer;
      font-weight:950;
    }
    .advanced-toggle span{color:rgba(17,24,39,.78);font-size:14px}
    .advanced-toggle .right{color:rgba(17,24,39,.55);font-weight:1000}
    .advanced-panel{display:none;margin-top:12px}
    .advanced-panel.open{display:block}

    .linkish{
      background:transparent;border:0;cursor:pointer;
      color:rgba(17,24,39,.78);
      font-weight:900;
      text-decoration:underline;
      text-underline-offset:3px;
    }
    .link-row{display:flex;justify-content:center;margin-top:12px}
    .disclaimer{font-size:12px;color:rgba(107,114,128,.92);text-align:center;margin-top:16px;line-height:1.35}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:86px;z-index:300;background:#111827;color:#fff;border-radius:12px;padding:10px 14px;font-weight:900;font-size:13px;display:none}
    .toast.show{display:block;animation:in .25s, out .25s 2.6s}
    @keyframes in{from{opacity:0;transform:translateX(-50%) translateY(12px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    @keyframes out{from{opacity:1}to{opacity:0}}

    .modal{position:fixed;inset:0;display:none;z-index:9999}
    .modal.is-open{display:block}
    .modal__backdrop{position:absolute;inset:0;background:rgba(15,23,42,.32);backdrop-filter: blur(6px)}
    .modal__panel{
      position:relative;
      width:min(760px, calc(100vw - 28px));
      max-height: calc(100vh - 28px);
      margin: 14px auto;
      background:#fff;
      border-radius: 18px;
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
      overflow:hidden;
      display:flex;flex-direction:column;
    }
    .modal__header{padding:18px 18px 12px;border-bottom:1px solid rgba(0,0,0,.06);position:relative}
    .modal__kicker{font-size:12px;letter-spacing:.08em;text-transform:uppercase;opacity:.65;margin-bottom:6px;font-weight:900}
    .modal__title{margin:0;font-size:18px;line-height:1.25;font-weight:1000}
    .modal__close{
      position:absolute;top:14px;right:14px;width:36px;height:36px;border-radius:12px;
      border:1px solid rgba(0,0,0,.08);background:#fff;cursor:pointer;opacity:.85;font-weight:1000;
    }
    .modal__close:hover{opacity:1}
    .modal__body{padding:16px 18px;overflow:auto;-webkit-overflow-scrolling:touch}
    .modal__divider{border:0;border-top:1px solid rgba(0,0,0,.08);margin:14px 0}
    .modal__footer{padding:12px 18px 16px;border-top:1px solid rgba(0,0,0,.06);display:flex;justify-content:flex-end}
    .manifesto__h{margin:0 0 10px;font-size:14px;opacity:.82;font-weight:1000}
    .manifesto__lead{margin:0 0 10px;font-size:15px}
    .manifesto p{margin:0 0 10px;line-height:1.45;opacity:.92}
    .manifesto__list{margin:6px 0 10px 18px;padding:0;line-height:1.45;opacity:.92}
    .manifesto__closing{margin-top:8px}
    .btn-primary{
      background:#111827;color:#fff;border:0;padding:10px 14px;border-radius:14px;cursor:pointer;font-weight:900;font-size:14px
    }
    .btn-primary:hover{filter:brightness(1.05)}
  </style>
</head>
<body>
  <div class="container">

    <section id="screen-home" class="screen active">
      <div class="topbar">
        <div class="topbar-inner">
          <div class="brand">
            <div class="name">DecideCar</div>
            <div class="sub">by RCO Labs</div>
          </div>
          <button class="iconbtn" onclick="openHelp()">Ajuda</button>
        </div>
      </div>

      <div class="hero">
        <h1>Comprar ou assinar um carro?</h1>
        <p>Decida com n√∫meros claros ‚Äî custo mensal, anual e no prazo total.</p>
        <div class="chips">
          <span class="chip">Modo r√°pido (default)</span>
          <span class="chip">Premissas edit√°veis no avan√ßado</span>
          <span class="chip">Sem cadastro</span>
        </div>
      </div>

      <button class="btn" onclick="goToInputs(false)">Simular (modo r√°pido)</button>
      <div class="link-row">
        <button class="linkish" onclick="goToInputs(true)">Quero ajustar premissas (modo avan√ßado)</button>
      </div>

      <div class="disclaimer" style="margin-top:14px">
        Ferramenta de apoio √† decis√£o. Resultados dependem das premissas informadas.
      </div>
    </section>

    <section id="screen-inputs" class="screen">
      <div class="topbar">
        <div class="topbar-inner">
          <button class="iconbtn" onclick="showScreen('screen-home')">‚Üê Voltar</button>
          <div class="brand">
            <div class="name">DecideCar</div>
            <div class="sub">Modo r√°pido</div>
          </div>
          <button class="iconbtn" onclick="openHelp()">Ajuda</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Modo r√°pido (recomendado)</h3>
        </div>
        <div class="card-sub">4 inputs e voc√™ decide. As premissas ficam no modo avan√ßado.</div>

        <div style="height:14px"></div>

        <div class="grid2">
          <div>
            <label>Pre√ßo do carro 0 km (R$)</label>
            <input type="text" id="preco" inputmode="numeric" value="150.000">
            <div class="help">Valor total do carro. (Sem financiamento no modelo.)</div>
          </div>
          <div>
            <label>Prazo</label>
            <select id="prazo">
              <option value="12">12 meses</option>
              <option value="24" selected>24 meses</option>
              <option value="36">36 meses</option>
              <option value="48">48 meses</option>
            </select>
            <div class="help">Prazo para comparar (compra vs assinatura).</div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="grid2">
          <div>
            <label>Mensalidade da assinatura (R$)</label>
            <input type="text" id="mensalidade" inputmode="numeric" value="2.800">
            <div class="help">Mensalidade base do contrato.</div>
          </div>
          <div>
            <label>Rentabilidade do seu capital (% ao ano)</label>
            <input type="text" id="rentabilidade" inputmode="decimal" value="12">
            <div class="help">Quanto seu dinheiro renderia se n√£o comprasse o carro.</div>
          </div>
        </div>
      </div>

      <div class="card">
        <button class="advanced-toggle" type="button" onclick="toggleAdvanced()">
          <span>Modo avan√ßado (ajustar premissas)</span>
          <span class="right" id="advancedArrow">+</span>
        </button>
        <div class="card-sub" style="margin-top:10px">
          Use apenas se quiser personalizar premissas (IPVA, seguro, desvaloriza√ß√£o, reajuste, extras).
        </div>

        <div id="advancedPanel" class="advanced-panel">
          <div style="height:12px"></div>

          <div class="section-title">Premissas da compra</div>
          <div class="grid2">
            <div>
              <label>IPVA (% ao ano)</label>
              <input type="text" id="ipva_pct" inputmode="decimal" value="4">
              <div class="help">Default (modo r√°pido): 4%.</div>
            </div>
            <div>
              <label>Seguro (R$ / ano)</label>
              <input type="text" id="seguro_anual" inputmode="numeric" value="6.000">
              <div class="help">Default: R$ 6.000/ano.</div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="grid2">
            <div>
              <label>Revis√µes / manuten√ß√£o (R$ / ano)</label>
              <input type="text" id="manut_anual" inputmode="numeric" value="1.200">
              <div class="help">Default: R$ 1.200/ano.</div>
            </div>
            <div>
              <label>Manuten√ß√£o a cada X meses</label>
              <input type="text" id="manut_meses" inputmode="numeric" value="12">
              <div class="help">Default: 12 meses (1x/ano).</div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="grid2">
            <div>
              <label>Desvaloriza√ß√£o inicial 0 km (%)</label>
              <input type="text" id="desval_inicial" inputmode="decimal" value="12">
              <div class="help">Default: 12% ao sair da loja.</div>
            </div>
            <div>
              <label>Desvaloriza√ß√£o anual (%)</label>
              <input type="text" id="desval_anual" inputmode="decimal" value="10">
              <div class="help">Default: 10% ao ano.</div>
            </div>
          </div>

          <div style="height:14px"></div>

          <div class="section-title">Premissas da assinatura</div>
          <div class="grid2">
            <div>
              <label>Reajuste anual do contrato (%)</label>
              <input type="text" id="reajuste_pct" inputmode="decimal" value="6">
              <div class="help">Default: 6% ao ano.</div>
            </div>
            <div>
              <label>Custo extra anual (R$)</label>
              <input type="text" id="extra_anual" inputmode="numeric" value="0">
              <div class="help">Ex.: excedente de km, servi√ßos, etc.</div>
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="rowbtns">
            <button class="btn secondary small" type="button" onclick="resetAdvanced()">Resetar avan√ßado</button>
            <button class="btn small" type="button" onclick="calcular()">Recalcular</button>
          </div>
        </div>
      </div>

      <div class="cta-fixed">
        <div class="cta-fixed-inner">
          <button class="btn" onclick="calcular()">Ver resultado</button>
        </div>
      </div>
    </section>

    <section id="screen-result" class="screen">
      <div class="topbar">
        <div class="topbar-inner">
          <button class="iconbtn" onclick="showScreen('screen-inputs')">‚Üê Voltar</button>
          <div class="brand">
            <div class="name">DecideCar</div>
            <div class="sub">Resultado</div>
          </div>
          <button class="iconbtn" onclick="compartilhar()">Compartilhar</button>
        </div>
      </div>

      <div class="card">
        <div class="muted" style="font-weight:950">Recomenda√ß√£o do DecideCar</div>
        <div class="badge" id="winner-badge"></div>
        <div class="big" id="winner-value"></div>
        <div class="muted" id="other-option"></div>
        <div class="diff" id="difference"></div>
      </div>

      <div class="card">
        <div class="insight" id="insight-text"></div>

        <div class="trust">
          <div style="font-weight:1000">Por que confiar?</div>
          <ul>
            <li>Considera custos recorrentes, desvaloriza√ß√£o e custo/benef√≠cio do dinheiro no tempo</li>
            <li>Mostra custo mensal, anual e total no prazo</li>
            <li>Premissas s√£o edit√°veis no modo avan√ßado</li>
            <li>Sem cadastro, sem an√∫ncio, sem vi√©s</li>
          </ul>
        </div>

        <div class="link-row" style="margin-top:12px">
          <button class="linkish" onclick="openManifesto()">Por tr√°s do DecideCar ‚Üí</button>
        </div>
      </div>

      <div class="card">
        <div class="section-title">Resumo no tempo</div>
        <div class="kpi3">
          <div class="kpi">
            <div class="t">Compra (ano)</div>
            <div class="v" id="compra-anual"></div>
            <div class="help" id="compra-anual-note"></div>
          </div>
          <div class="kpi">
            <div class="t">Assinatura (ano)</div>
            <div class="v" id="assinatura-anual"></div>
            <div class="help" id="assinatura-anual-note"></div>
          </div>
          <div class="kpi">
            <div class="t">Diferen√ßa (ano)</div>
            <div class="v" id="diff-anual"></div>
            <div class="help">Compara√ß√£o anualizada.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="kpi3">
          <div class="kpi">
            <div class="t">Compra (total)</div>
            <div class="v" id="compra-total"></div>
            <div class="help">No prazo escolhido.</div>
          </div>
          <div class="kpi">
            <div class="t">Assinatura (total)</div>
            <div class="v" id="assinatura-total"></div>
            <div class="help">No prazo escolhido.</div>
          </div>
          <div class="kpi">
            <div class="t">Diferen√ßa (total)</div>
            <div class="v" id="diff-total"></div>
            <div class="help">Compra vs assinatura.</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section-title">Gr√°ficos claros</div>

        <div class="chart-wrap">
          <div class="muted" style="font-weight:950;margin-bottom:8px">Custo total no prazo (Compra vs Assinatura)</div>
          <canvas id="chartTotal" width="520" height="220"></canvas>
          <div class="chart-note">Barras lado a lado no per√≠odo escolhido.</div>
        </div>

        <div style="height:12px"></div>

        <div class="chart-wrap">
          <div class="muted" style="font-weight:950;margin-bottom:8px">O que mais pesa (composi√ß√£o)</div>
          <canvas id="chartMix" width="520" height="220"></canvas>
          <div class="chart-note">Componentes principais da compra e da assinatura.</div>
        </div>
      </div>

      <div class="rowbtns">
        <button class="btn secondary" onclick="showScreen('screen-inputs')">Editar inputs</button>
        <button class="btn" onclick="compartilhar()">Copiar convite</button>
      </div>

      <div class="disclaimer">
        DecideCar ‚Äî by RCO Labs ‚Ä¢ Ferramenta de apoio √† decis√£o.
      </div>
    </section>
  </div>

  <div id="toast" class="toast">Copiado!</div>

  <div id="helpModal" class="modal" aria-hidden="true">
    <div class="modal__backdrop" onclick="closeHelp()"></div>
    <div class="modal__panel" role="document">
      <div class="modal__header">
        <div class="modal__kicker">DecideCar</div>
        <h2 class="modal__title">Como usar</h2>
        <button class="modal__close" type="button" onclick="closeHelp()">‚úï</button>
      </div>
      <div class="modal__body">
        <div class="manifesto">
          <p><strong>Modo r√°pido</strong>: preencha 4 inputs e veja a recomenda√ß√£o.</p>
          <p><strong>Modo avan√ßado</strong>: ajuste premissas (IPVA, seguro, desvaloriza√ß√£o, reajuste, extras) se quiser personalizar.</p>
          <p>O DecideCar compara custo mensal, anual e no prazo total ‚Äî com base em custos recorrentes, desvaloriza√ß√£o e custo/benef√≠cio do dinheiro no tempo.</p>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn-primary" onclick="closeHelp()">Entendi</button>
      </div>
    </div>
  </div>

  <div id="manifestoModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="manifestoTitle" aria-hidden="true">
    <div class="modal__backdrop" onclick="closeManifesto()"></div>

    <div class="modal__panel" role="document">
      <div class="modal__header">
        <div class="modal__kicker">RCO Labs</div>
        <h2 id="manifestoTitle" class="modal__title">Por tr√°s do DecideCar</h2>

        <button class="modal__close" type="button" onclick="closeManifesto()" aria-label="Fechar manifesto">
          ‚úï
        </button>
      </div>

      <div class="modal__body">
        <section class="manifesto">
          <h3 class="manifesto__h">Manifesto ‚Äî RCO Labs</h3>

          <p class="manifesto__lead"><strong>Decis√£o melhor come√ßa com estrutura melhor.</strong></p>

          <p>
            A RCO Labs nasce de uma inquieta√ß√£o simples:
            boas decis√µes seguem sendo tomadas com base em intui√ß√£o, h√°bito ou discurso pronto ‚Äî quando poderiam ser tomadas com clareza, estrutura e n√∫meros simples.
          </p>

          <p>
            N√≥s n√£o constru√≠mos ferramentas para parecer inteligentes.
            Constru√≠mos ferramentas para tornar decis√µes mais √≥bvias.
          </p>

          <p><strong>Acreditamos que:</strong></p>
          <ul class="manifesto__list">
            <li>complexidade deve ficar no bastidor,</li>
            <li>a interface deve ser simples,</li>
            <li>e o resultado precisa orientar uma escolha real.</li>
          </ul>

          <p>
            RCO Labs √© um laborat√≥rio de produtos pr√°ticos, criados para pessoas que precisam decidir hoje ‚Äî n√£o para apresenta√ß√µes bonitas amanh√£.
          </p>

          <p class="manifesto__closing">
            <strong>Menos achismo.</strong><br />
            <strong>Mais crit√©rio.</strong><br />
            <strong>Mais decis√£o.</strong>
          </p>
        </section>

        <hr class="modal__divider" />

        <section class="manifesto">
          <h3 class="manifesto__h">Manifesto ‚Äî DecideCar</h3>

          <p class="manifesto__lead"><strong>Decidir carro n√£o deveria ser confuso.</strong></p>

          <p>
            Comprar ou assinar um carro virou um debate raso.
            De um lado, quem defende posse.
            Do outro, quem vende conveni√™ncia.
          </p>

          <p>
            O DecideCar n√£o escolhe lados.
            Ele organiza os n√∫meros.
          </p>

          <p>
            Aqui, a decis√£o n√£o vem de opini√£o, discurso ou ‚Äúsensa√ß√£o‚Äù.
            Vem do custo real ‚Äî mensal, anual e no prazo total ‚Äî considerando o que mais pesa e quase nunca √© comparado:
            o custo do dinheiro, o tempo e a desvaloriza√ß√£o.
          </p>

          <p class="manifesto__lead"><strong>Qual op√ß√£o custa menos no seu perfil?</strong></p>

          <p class="manifesto__closing">
            Sem cadastro.<br />
            Sem an√∫ncio.<br />
            Sem vi√©s.
          </p>

          <p>S√≥ n√∫meros claros para uma decis√£o melhor.</p>
        </section>
      </div>

      <div class="modal__footer">
        <button type="button" class="btn-primary" onclick="closeManifesto()">Entendi</button>
      </div>
    </div>
  </div>

  <script>
    let resultadoAtual = null;

    function showScreen(id){
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      window.scrollTo(0,0);
    }
    function goToInputs(openAdvanced){
      loadFromLocalStorage();
      showScreen('screen-inputs');
      const panel = document.getElementById('advancedPanel');
      const arrow = document.getElementById('advancedArrow');
      if(openAdvanced){
        panel.classList.add('open');
        arrow.textContent = '‚àí';
        document.querySelector('#screen-inputs .brand .sub').textContent = 'Modo avan√ßado';
      }else{
        panel.classList.remove('open');
        arrow.textContent = '+';
        document.querySelector('#screen-inputs .brand .sub').textContent = 'Modo r√°pido';
      }
    }

    function parseMoney(str){
      if(str===null || str===undefined) return 0;
      const s = String(str).trim()
        .replace(/\s/g,'')
        .replace(/R\$/g,'')
        .replace(/\./g,'')
        .replace(',', '.');
      const v = parseFloat(s);
      return Number.isFinite(v) ? v : 0;
    }
    function formatMoneyRaw(n){
      const v = Math.round(Number(n||0));
      return v.toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.');
    }
    function formatCurrency(n){ return 'R$ ' + formatMoneyRaw(n); }
    function clampPct(p){
      if(!Number.isFinite(p)) return 0;
      if(p < 0) return 0;
      if(p > 100) return 100;
      return p;
    }
    function showToast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg || 'Copiado!';
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 3000);
    }

    const LS_KEY = 'decidecar_v2_experience';
    function saveToLocalStorage(){
      const ids = [
        'preco','prazo','mensalidade','rentabilidade',
        'ipva_pct','seguro_anual','manut_anual','manut_meses',
        'desval_inicial','desval_anual',
        'reajuste_pct','extra_anual'
      ];
      const data = {};
      ids.forEach(id => { const el = document.getElementById(id); if(el) data[id] = el.value; });
      localStorage.setItem(LS_KEY, JSON.stringify(data));
    }
    function loadFromLocalStorage(){
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        Object.keys(data).forEach(id=>{
          const el = document.getElementById(id);
          if(el) el.value = data[id];
        });
      }catch(_){}
    }

    function toggleAdvanced(){
      const panel = document.getElementById('advancedPanel');
      const arrow = document.getElementById('advancedArrow');
      const open = panel.classList.toggle('open');
      arrow.textContent = open ? '‚àí' : '+';
      document.querySelector('#screen-inputs .brand .sub').textContent = open ? 'Modo avan√ßado' : 'Modo r√°pido';
      if(open) panel.scrollIntoView({behavior:'smooth', block:'start'});
    }
    function resetAdvanced(){
      document.getElementById('ipva_pct').value = '4';
      document.getElementById('seguro_anual').value = '6.000';
      document.getElementById('manut_anual').value = '1.200';
      document.getElementById('manut_meses').value = '12';
      document.getElementById('desval_inicial').value = '12';
      document.getElementById('desval_anual').value = '10';
      document.getElementById('reajuste_pct').value = '6';
      document.getElementById('extra_anual').value = '0';
      showToast('Premissas resetadas.');
      saveToLocalStorage();
    }

    function openManifesto(){
      const m = document.getElementById('manifestoModal');
      m.classList.add('is-open');
      m.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeManifesto(){
      const m = document.getElementById('manifestoModal');
      m.classList.remove('is-open');
      m.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    function openHelp(){
      const m = document.getElementById('helpModal');
      m.classList.add('is-open');
      m.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeHelp(){
      const m = document.getElementById('helpModal');
      m.classList.remove('is-open');
      m.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape'){
        const a = document.getElementById('manifestoModal');
        const h = document.getElementById('helpModal');
        if(a && a.classList.contains('is-open')) closeManifesto();
        if(h && h.classList.contains('is-open')) closeHelp();
      }
    });

    function calcular(){
      saveToLocalStorage();

      const P = parseMoney(document.getElementById('preco').value);
      const T = parseInt(document.getElementById('prazo').value,10);
      const mensalidade = parseMoney(document.getElementById('mensalidade').value);
      const r_pct = clampPct(parseFloat(document.getElementById('rentabilidade').value)) / 100;

      const ipva_pct = clampPct(parseFloat(document.getElementById('ipva_pct').value)) / 100;
      const seguro_anual = parseMoney(document.getElementById('seguro_anual').value);
      const manut_anual = parseMoney(document.getElementById('manut_anual').value);
      const manut_meses = Math.max(1, parseInt(document.getElementById('manut_meses').value || '12',10));

      const desval_inicial = clampPct(parseFloat(document.getElementById('desval_inicial').value)) / 100;
      const desval_anual = clampPct(parseFloat(document.getElementById('desval_anual').value)) / 100;

      const reaj_pct = clampPct(parseFloat(document.getElementById('reajuste_pct').value)) / 100;
      const extra_anual = parseMoney(document.getElementById('extra_anual').value);

      if(P<=0 || !Number.isFinite(T) || T<=0){
        showToast('Preencha o pre√ßo do carro e o prazo.');
        return;
      }

      const anos = T/12;

      let revenda = P * (1 - desval_inicial) * Math.pow(1 - desval_anual, anos);

      const ipva_total = (P * ipva_pct) * anos;
      const seguro_total = seguro_anual * anos;

      const num_manut = Math.ceil(T / manut_meses);
      const custo_por_evento = manut_anual / Math.max(1, (12 / manut_meses));
      const manut_total = num_manut * custo_por_evento;

      const fator = Math.pow(1 + r_pct, anos);
      const ganho_potencial = P * (fator - 1);

      const desval_total = Math.max(0, P - revenda);
      const recorr_total = ipva_total + seguro_total + manut_total;

      const custo_compra_total = recorr_total + desval_total + ganho_potencial;

      let mens_total = 0;
      const anos_cheios = Math.floor(T/12);
      const meses_restantes = T % 12;
      for(let k=0;k<anos_cheios;k++){
        mens_total += 12 * mensalidade * Math.pow(1 + reaj_pct, k);
      }
      mens_total += meses_restantes * mensalidade * Math.pow(1 + reaj_pct, anos_cheios);

      const extra_total = extra_anual * anos;

      let custo_ass_total = (mens_total + extra_total) - ganho_potencial;
      custo_ass_total = Math.max(0, custo_ass_total);

      const mensal_compra = custo_compra_total / T;
      const mensal_ass = custo_ass_total / T;
      const anual_compra = mensal_compra * 12;
      const anual_ass = mensal_ass * 12;

      const winner = (mensal_compra <= mensal_ass) ? 'COMPRA' : 'ASSINATURA';
      const winner_value = (winner === 'COMPRA') ? mensal_compra : mensal_ass;
      const other_value  = (winner === 'COMPRA') ? mensal_ass : mensal_compra;

      const diff_mensal = Math.abs(mensal_compra - mensal_ass);
      const diff_anual  = Math.abs(anual_compra - anual_ass);
      const diff_total  = Math.abs(custo_compra_total - custo_ass_total);

      const driverCompra = [
        {k:'Desvaloriza√ß√£o', v: desval_total},
        {k:'Custos recorrentes', v: recorr_total},
        {k:'Custo do dinheiro', v: ganho_potencial}
      ].sort((a,b)=>b.v-a.v)[0].k;

      const driverAss = [
        {k:'Mensalidades', v: mens_total},
        {k:'Extras', v: extra_total},
        {k:'Benef√≠cio do dinheiro', v: ganho_potencial}
      ].sort((a,b)=>b.v-a.v)[0].k;

      let insightText = '';
      if(winner === 'COMPRA'){
        insightText =
          `No seu perfil, COMPRAR √© mais eficiente. Em ${T} meses, voc√™ economiza ${formatCurrency(diff_total)}. ` +
          `O que mais pesa na compra √©: ${driverCompra}.`;
      }else{
        insightText =
          `No seu perfil, ASSINAR √© mais eficiente. Em ${T} meses, voc√™ economiza ${formatCurrency(diff_total)}. ` +
          `O que mais pesa na assinatura √©: ${driverAss}.`;
      }

      document.getElementById('winner-badge').textContent = winner;
      document.getElementById('winner-value').textContent = formatCurrency(winner_value) + ' / m√™s';
      document.getElementById('other-option').textContent  = 'A outra op√ß√£o: ' + formatCurrency(other_value) + ' / m√™s';
      document.getElementById('difference').textContent    = 'Diferen√ßa: ' + formatCurrency(diff_mensal) + ' / m√™s';
      document.getElementById('insight-text').textContent  = insightText;

      document.getElementById('compra-anual').textContent = formatCurrency(anual_compra);
      document.getElementById('assinatura-anual').textContent = formatCurrency(anual_ass);
      document.getElementById('diff-anual').textContent = formatCurrency(diff_anual);

      document.getElementById('compra-total').textContent = formatCurrency(custo_compra_total);
      document.getElementById('assinatura-total').textContent = formatCurrency(custo_ass_total);
      document.getElementById('diff-total').textContent = formatCurrency(diff_total);

      document.getElementById('compra-anual-note').textContent = `~ ${formatCurrency(mensal_compra)} / m√™s`;
      document.getElementById('assinatura-anual-note').textContent = `~ ${formatCurrency(mensal_ass)} / m√™s`;
      document.getElementById('assinatura-anual-note').textContent = `~ ${formatCurrency(mensal_ass)} / m√™s`;

      drawGroupedBars('chartTotal', [
        {label:'Compra', value:custo_compra_total},
        {label:'Assinatura', value:custo_ass_total}
      ]);

      drawMix('chartMix', [
        {label:'Compra: Desvaloriza√ß√£o', value:desval_total},
        {label:'Compra: Recorrentes', value:recorr_total},
        {label:'Compra: Custo do dinheiro', value:ganho_potencial},
        {label:'Assinatura: Mensalidades', value:mens_total},
        {label:'Assinatura: Extras', value:extra_total},
        {label:'Assinatura: Benef√≠cio do dinheiro', value:ganho_potencial}
      ]);

      resultadoAtual = { winner, diff_mensal, diff_total, T };

      showScreen('screen-result');
    }

    function clearCanvas(id){
      const c = document.getElementById(id);
      if(!c) return null;
      const ctx = c.getContext('2d');
      ctx.clearRect(0,0,c.width,c.height);
      return {c, ctx};
    }

    function drawGroupedBars(canvasId, bars){
      const obj = clearCanvas(canvasId);
      if(!obj) return;
      const {c, ctx} = obj;
      const w=c.width, h=c.height;

      const pL=46, pR=18, pT=18, pB=34;
      const innerW = w - pL - pR;
      const innerH = h - pT - pB;

      const maxV = Math.max(...bars.map(b=>b.value), 1);

      ctx.strokeStyle = 'rgba(17,24,39,.14)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(pL, pT);
      ctx.lineTo(pL, h-pB);
      ctx.lineTo(w-pR, h-pB);
      ctx.stroke();

      ctx.fillStyle = 'rgba(107,114,128,.95)';
      ctx.font = '12px -apple-system, Segoe UI, Inter, sans-serif';
      for(let i=0;i<=3;i++){
        const y = pT + innerH*(i/3);
        ctx.strokeStyle = 'rgba(17,24,39,.06)';
        ctx.beginPath(); ctx.moveTo(pL, y); ctx.lineTo(w-pR, y); ctx.stroke();
        const val = maxV*(1 - i/3);
        ctx.fillText('R$ ' + formatMoneyRaw(val), 6, y+4);
      }

      const barW = innerW / (bars.length*2 + (bars.length-1));
      let x = pL + barW;

      bars.forEach((b, idx)=>{
        const bh = innerH * (b.value / maxV);
        const y = (h-pB) - bh;

        ctx.fillStyle = (idx===0) ? 'rgba(17,24,39,.85)' : 'rgba(17,24,39,.45)';
        ctx.fillRect(x, y, barW*2, bh);

        ctx.fillStyle = 'rgba(17,24,39,.85)';
        ctx.font = '12px -apple-system, Segoe UI, Inter, sans-serif';
        ctx.fillText(b.label, x, h-12);

        ctx.font = '12px -apple-system, Segoe UI, Inter, sans-serif';
        ctx.fillText(formatCurrency(b.value), x, Math.max(pT+12, y-6));

        x += (barW*3);
      });
    }

    function drawMix(canvasId, items){
      const obj = clearCanvas(canvasId);
      if(!obj) return;
      const {c, ctx} = obj;
      const w=c.width, h=c.height;

      const p=16;
      const startY=28;
      const rowH=22;
      const gap=10;

      const maxV = Math.max(...items.map(i=>i.value), 1);

      ctx.font = '12px -apple-system, Segoe UI, Inter, sans-serif';

      items.forEach((it, i)=>{
        const y = startY + i*(rowH+gap);
        if(y + rowH > h - 10) return;

        ctx.fillStyle = 'rgba(107,114,128,.95)';
        ctx.fillText(it.label, p, y-4);

        ctx.fillStyle = 'rgba(17,24,39,.06)';
        ctx.fillRect(p, y, w - p*2, rowH);

        const bw = (w - p*2) * (it.value / maxV);
        ctx.fillStyle = (it.label.startsWith('Compra')) ? 'rgba(17,24,39,.75)' : 'rgba(17,24,39,.35)';
        ctx.fillRect(p, y, bw, rowH);

        ctx.fillStyle = 'rgba(17,24,39,.85)';
        ctx.fillText(formatCurrency(it.value), p + Math.min(bw + 8, (w - p*2) - 90), y + 15);
      });
    }

    function compartilhar(){
      const url = window.location.href;
      let texto =
`üöó Comprar ou assinar um carro?
Usei o DecideCar (RCO Labs) para comparar comprar vs assinar.`;
      if(resultadoAtual){
        texto += ` No meu perfil, deu ${resultadoAtual.winner} com diferen√ßa de ${formatCurrency(resultadoAtual.diff_mensal)}/m√™s no prazo de ${resultadoAtual.T} meses.`;
      }
      texto += ` Testa tamb√©m e decide com n√∫mero, n√£o com achismo.\nSimule aqui: ${url}`;

      if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(texto).then(()=>showToast('Copiado!')).catch(()=>fallbackCopy(texto));
      }else{
        fallbackCopy(texto);
      }
    }
    function fallbackCopy(text){
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand('copy'); showToast('Copiado!'); }
      catch(_){ showToast('N√£o foi poss√≠vel copiar.'); }
      document.body.removeChild(ta);
    }

    loadFromLocalStorage();
  </script>
</body>
</html>
